diff --git a/Cakefile b/Cakefile
index 4d2d023..08e294f 100644
--- a/Cakefile
+++ b/Cakefile
@@ -40,8 +40,15 @@ visitDirectory = (directory, visitor) ->
     visitor(filepath)

 task "build", "compile all coffeescript files to javascript", ->
-  coffee = spawn "coffee", ["-c", __dirname]
-  coffee.on 'exit', (returnCode) -> process.exit returnCode
+  stdout = child_process.execSync("./node_modules/.bin/babel src -d .")
+  for line in stdout.toString().split('\n')
+    line = line.trim()
+    if line
+      outPath = line.split(' ')[2]
+      console.log('Fixing file ' + outPath)
+      contents = fs.readFileSync(outPath)
+      contents = ";(function() {\n#{contents};\n})();"
+      fs.writeFileSync(outPath, contents)

 task "clean", "removes any js files which were compiled from coffeescript", ->
   visitDirectory __dirname, (filepath) ->
diff --git a/pages/hud.html b/pages/hud.html
index 9532afc..4acf507 100644
--- a/pages/hud.html
+++ b/pages/hud.html
@@ -2,6 +2,7 @@
   <head>
     <title>HUD</title>
     <link rel="stylesheet" type="text/css" href="../content_scripts/vimium.css" />
+    <script type="text/javascript" src="../node_modules/babel-polyfill/dist/polyfill.js"></script>
     <script type="text/javascript" src="../lib/utils.js"></script>
     <script type="text/javascript" src="../lib/dom_utils.js"></script>
     <script type="text/javascript" src="../lib/keyboard_utils.js"></script>
diff --git a/pages/vomnibar.html b/pages/vomnibar.html
index 87acc08..392c03f 100644
--- a/pages/vomnibar.html
+++ b/pages/vomnibar.html
@@ -1,6 +1,7 @@
 <html>
   <head>
     <title>Vomnibar</title>
+    <script type="text/javascript" src="../node_modules/babel-polyfill/dist/polyfill.js"></script>
     <script type="text/javascript" src="../lib/utils.js"></script>
     <script type="text/javascript" src="../lib/keyboard_utils.js"></script>
     <script type="text/javascript" src="../lib/dom_utils.js"></script>
diff --git a/tests/dom_tests/dom_tests.html b/tests/dom_tests/dom_tests.html
index d2e795d..78a7e77 100644
--- a/tests/dom_tests/dom_tests.html
+++ b/tests/dom_tests/dom_tests.html
@@ -29,6 +29,7 @@
     <link rel="stylesheet" type="text/css" href="../../content_scripts/vimium.css" />
     <script type="text/javascript" src="bind.js"></script>
     <script type="text/javascript" src="chrome.js"></script>
+    <script type="text/javascript" src="../../node_modules/babel-polyfill/dist/polyfill.js"></script>
     <script type="text/javascript" src="../../lib/utils.js"></script>
     <script type="text/javascript" src="../../lib/keyboard_utils.js"></script>
     <script type="text/javascript" src="../../lib/dom_utils.js"></script>
